{{ block "template" . -}}
<!DOCTYPE html>
<html lang='en'>
<head>
    <meta charset='UTF-8'>
    <title>{{ .PageTitle }}</title>
    <style>
		:root {
			/* using the semi-magic value "42" for colors intended to be pure white/gray/black */
			--color-font-primary: hsl(42, 0%, 95%);
			--color-background-primary: hsl(42, 0%, 10%);

			--color-font-secondary: var(--color-font-primary);
			--color-background-secondary: hsl(42, 0%, 20%);

			--color-font-tertiary: hsl(42, 0%, 90%);
			--color-background-tertiary: var(--color-background-secondary);

			/* calls */

			--color-font-called-it: hsl(120, 50%, 90%);
			--color-background-called-it: hsl(120, 50%, 33%);

			--color-font-missed-it: hsl(0, 50%, 33%);
			--color-background-missed-it: hsl(0, 50%, 90%);

			--color-font-ongoing: inherit;
			--color-background-ongoing: inherit;

			--color-font-excluded: black;
			--color-background-excluded: white;
		}
        
        html {
            font-family: system-ui, sans-serif;
            --radius: 0rem;
            --border-style-internal: thin dotted gray;

			color: var(--color-font-primary);
			background: var(--color-background-primary);
        }

        section {
            padding: 0 .5rem;
        }
        
        .document {
            display: grid;
            
            /* percent, claim, result, tags, notes, excluded */
            grid-template:
                'p c'
                'r t'
                'r n'
                'e e'
                / 15ch 1fr;

            border: thin solid gray;
            border-radius: var(--radius);

            padding: 0;
        }

        .document > * {
			color: var(--color-font-secondary);
			background: var(--color-background-secondary);

            padding: .25rem;
        }

        .percent {
            grid-area: p;
            font-size: 300%;
            font-weight: 900;
            text-align: center;
            border-top-left-radius: var(--radius);

            border-bottom: var(--border-style-internal);
            border-right: var(--border-style-internal);
        }

        .percent > div {
            padding-bottom: .5rem;
        }

        .claim {
            grid-area: c;
            font-size: 200%;

            border-top-right-radius: var(--radius);
            border-bottom: var(--border-style-internal);
        }

        .result {
            grid-area: r;

            border-bottom-left-radius: var(--radius);
            border-right: var(--border-style-internal);
        }

        .result.true {
			background: var(--color-background-called-it);
			color: var(--color-text-called-it);
        }

        .result.false {
            background: var(--color-background-missed-it);
            color: var(--color-background-missed-it);
        }

        .result.ongoing {
            /* the default is fine, really */
        }

        .result.excluded {
            color: white;
            background: black;
        }

        .tags {
            grid-area: t;

			color: var(--color-font-tertiary);

            border-bottom: var(--border-style-internal);
        }

        .notes {
            grid-area: n;
            border-bottom-right-radius: var(--radius);
        }

        .notes :first-child {
            margin-top: 0;
        }

        .notes :last-child {
            margin-bottom: 0;
        }

        .cause-for-exclusion {
            grid-area: e;
        }

        /* Analysis */

        .analysis {
            font-feature-settings: "tnum";
        }

        .analysis th,
        .analysis td {
            text-align: right;
        }

        .analysis td:first-of-type {
            text-align: right;
        }

        .analysis .outdented {
            padding-right: 1em;
        }

        .brier-explanation {
            color: hsl(0, 0%, 33%);
            text-align: justify;
            -webkit-hyphens: auto;
            hyphens: auto;
        }


        /* utility classes */

        .center-child {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .center-child-vertically {
            display: flex;
            align-items: center;
            justify-content: start;
        }
    </style>
</head>
<body>
    {{ with .Analysis.Everything }}
        {{ template "analyzeddocuments" . }}
    {{ end }}

    {{ range .Analysis.EverythingByKey }}
        {{ template "analyzeddocuments" . }}
    {{ end }}

    {{ range .Analysis.EverythingByTag }}
        {{ template "analyzeddocuments" . }}
    {{ end }}
</body>
</html>
{{- end }}
{{ define "analyzeddocuments" }}
    <section>
        <hgroup>
            {{ with .AnalysisUnit.Title }}<h1>{{ . }}</h1>{{ end }}
        </hgroup>

        <section class='predictions'>
            {{ range .Documents }}
            <section class='document'>
                <div class='percent center-child'><div>{{ .Confidence }}%</div></div>
                {{ $class := "" }}
                {{ $message := "" }}
                {{- if eq (troolToString .Happened) "true" -}}
                    {{ $class = "true" }}
                    {{ $message = "called it" }}
                {{- else if eq (troolToString .Happened) "false" -}}
                    {{ $class = "false" }}
                    {{ $message = "missed it" }}
                {{- else if ne .CauseForExclusion "" -}}
                    {{ $class = "excluded" }}
                    {{ $message = "excluded" }}
                {{- else -}}
                    {{ $class = "ongoing" }}
                    {{ $message = "ongoing" }}
                {{- end -}}
                <div class='result {{ $class }} center-child'><div>{{ $message }}</div></div>    
                <div class='claim center-child-vertically'><div>{{ .Claim }}</div></div>
                <div class='tags'>tags: {{ commaSeparate .Tags }}</div>
                <div class='notes'>{{ .Notes | safeHTML }}</div>
                {{ with .CauseForExclusion }}<div class='cause-for-exclusion'>{{ . }}</div>{{ end }}
            </section>
            {{ end }}
        </section>

        {{ with .AnalysisUnit | refAU }}
        <section class=''>
            <h1>Analysis</h1>
            <table class='analysis'>
                <tr><th scope='row'>Total:           <td>{{ .Total }}<td><td><td><td>
                <tr><th scope='row'>of total, Called:<td><td>{{ .Called }}<td>{{ .OfTotalCalled | printf "(%.2f%%)"}}
                <tr><th scope='row'>of total, Missed:<td><td>{{ .Missed }}<td>{{ .OfTotalMissed | printf "(%.2f%%)"}}

                <tr><th scope='row'>of total, Scored:<td><td>{{ .Scored }}<td>{{ .OfTotalScored | printf "(%.2f%%)"}}
                <tr><th scope='row'>of scored, Called:<td><td><td><td>{{ .Called }}<td>{{ .OfScoredCalled | printf "(%.2f%%)"}}
                <tr><th scope='row'>of scored, Missed:<td><td><td><td>{{ .Missed }}<td>{{ .OfScoredMissed | printf "(%.2f%%)"}}
                
                <tr><th scope='row'>of total, Unscored:<td><td>{{ .Unscored }}<td>{{ .OfTotalUnscored | printf "(%.2f%%)"}}
                <tr><th scope='row'>of unscored, Ongoing:<td><td><td><td>{{ .Ongoing }}<td>{{ .OfUnscoredOngoing | printf "(%.2f%%)"}}
                <tr><th scope='row'>of unscored, Excluded:<td><td><td><td>{{ .Excluded }}<td>{{ .OfUnscoredExcluded | printf "(%.2f%%)"}}
                <tr><th scope='row'>Brier score:<td colspan='2'>{{ .BrierScore | printf "%.4f" }}
            </table>
            <p class='brier-explanation'>Brier scores range from 0 to 1, inclusive. A Brier score of 0 means you’re 100% confident every time and everything you predict happens. A Brier score of 1 means you’re 100% confident every time and you’re wrong every single time. If you estimate that everything has a 50/50 chance of happening, your Brier score will be .25 regardless of whatever happens.</p>
        </section>
        {{ end }}
    </section>

{{ end }}
